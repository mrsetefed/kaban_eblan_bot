import random
from datetime import datetime
from telegram import Update
from telegram.ext import ContextTypes

COMMENTS = [
    "๐คก",
    "ะขะตะฑะต ะปัััะตะน ัะนัะธ, ััะพ ะผะตััะพ ัะพะปัะบะพ ะดะปั ะบััััั",
    "ะะฐะฒะฝะพ ัะตะฑั ะฝะต ะฑัะปะพ ะฒ ัะปะธัะฝัั ะณะพะฝะบะฐั",
    "ะญัะพ ะฝะต ัะฒะพะต...",
    "ะฬธอฬอออออฬฬฬฬฬฬอฬออออฬงฬอฬอฬฬฌฬณะดฬทอฬฟฬฬขฬงฬฎฬฆฬณฬบฬฬอฬกอฬจฬฒะธฬธอฬฬฬฬฬอออฬซออฬฅฬบฬอออฬงฬป ฬดฬฬฬอฬอฬฬอฬออออฬคะฝฬตฬฬฬฬอะฐฬถอฬซัฬตฬฬฬฝอฬอฬงฬฃอฬคัฬดฬฬฬออฬออฬฉฬฆฬฌฬณฬฏฬขอออะนฬธอฬฬฬออฬฬอฬฟฬฬอฬฉอออฬขฬฬฬ",
    "ะะพั",
    "ะะฐ ัั ะทะฝะฐัะฝัะน ะปัะฑะธัะตะปั ะบะพะฟัะพ-ััะตั",
    "ะขั ัะดะฐััะฐะธะฒะฐะตัััั ะฝะพะฒะพะณะพ ัะธััะปะฐ: ะัะฐะบ",
    "ะฏ ัะพัั: ะพัััะถะบั ะบะฐะบ ั ะณะพะดะทะธะปะปั ...",
    "... ะฒะพะฝััะธะน ััะน ะธ ...",
    "ะะพัะฝัะต ัะนัะฐ!!!",
    "ะฃ ัะตะฑั ะฝะตั ะฝะธ ะฐััั, ะฝะธ ะบัััะพััะธ",
    "ะะฐ ัะฐะทะณะพะฒะพั ั ัะฐะบะธะผะธ ะบะฐะบ ัั ะฒ ะบะปัะฑะต ะบััััั ะพะฑััะฝะพ ะพะฟััะบะฐัั",
    "ะะฐะฟะฐะฟะตะฒะฐ ะณะตะผะฐะฑะพะดะธ",
    "ะขะฒะพั ะฐััะฐ ัะปะฐะฑะฐ",
    "ะะฐะปะบะพ ัะตะฑั...",
    "ะัะต ะฝะต ะบััั, ะฝะพ ัะถะต ะธ ะฝะต ะปะพั",
    "ะะฐ ัะฐะทะณะพะฒะพั ั ัะพะฑะพะน ะฑะพะปััะต ะฝะต ะพะฟััััั ะฒ ะบะปัะฑะต ะบััััั",
    "ะฏ ะฝะต ะฟัะธะดัะผะฐะป( ะะพัะผะตะนัั ั ััะพะณะพ, ะฟะพะถะฐะปัะนััะฐ",
    "ะฏ ัะพัั ะฟะธััั...(",
    "ะ ัั ัะพัะฝะพ ะฝะต ัะธัะตัะธัั?",
    "ะัััะธะน ะธะท ััะดัะธั.",
    "ะะพะฑัะพ ะฟะพะถะฐะปะพะฒะฐัั ะฒ ะบะปัะฑ ะบััััั",
    "ะฅัะดัะธะน ะธะท ะปัััะธั",
    "ะะฝะฐัะฝะฐั ะฐััะฐ",
    "ะขั ะดะฐะถะต ะผะพะถะตัั ะฒัะดะฐะฒะฐัั ัะธััะปั ะฒัะตะผ, ะบัะพ ะฝะต ััะฐััะฒัะตั ะฒ ะบะปัะฑะต",
    "ะะฑะปะพะฑะพั ะพะดะพะฑััะตั.",
    "ะัะพะนะดะตะฝ ะฟะพัะพะณ ะบัััะพััะธ ะพะฑััะฝะพะณะพ ัะตะปะพะฒะตะบะฐ, ัะตะฟะตัั ัั ะฒะพะธััะธะฝั ะะะฃะขะะ, ะฟะพะทะดัะฐะฒะปัั.",
    "ะขะตะฑะต ะดะพัััะฟะฝะฐ ะฑะตัะฟะปะฐัะฝะฐั ัะฐะทะดะฐัะฐ ะบะธัะธะตัะตะบ, ะฝะต ะทะฐะฑัะดั ะทะฐะนัะธ.",
    "๐ง",
    "ะะณัะพะผะฝัะน ััะน ะฑะพะปััะธะต ัะนัะฐ",
    "ะััะฐะปะพัั ัะพะฒัะตะผ ะฝะตะผะฝะพะณะพ. ะขะตะฑะต ะฝัะถะฝะพ ะฑะพะปััะต ััะตะฝะธัะพะฒะฐัััั.",
    "ะัะต ัะพะฒัะตะผ ัััั ัััั...",
    "ะะพะทะดัะฐะฒะปัั, ะดะพััะธะณะฝััะฐ ะฐะฑัะพะปััะฝะฐั ะบัััะพััั!"
]

# ะะฐะผััั ะฝะฐ ะฒัะตะผั ัะฐะฑะพัั ะฑะพัะฐ
user_results = {}

async def krutometr(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    today_str = datetime.now().strftime("%Y-%m-%d")

    # ะงะธััะธะผ ััะฐััะต ะทะฐะฟะธัะธ (ะพััะฐะฒะปัะตะผ ัะพะปัะบะพ ัะตะณะพะดะฝััะฝะธะต)
    to_delete = [uid for uid, (date, _, _) in user_results.items() if date != today_str]
    for uid in to_delete:
        del user_results[uid]

    # ะัะพะฒะตััะตะผ, ะตััั ะปะธ ัะตะทัะปััะฐั ะทะฐ ัะตะณะพะดะฝั
    if user_id in user_results:
        saved_date, saved_score, saved_comment = user_results[user_id]
        message = f"ะขะฒะพะน ััะพะฒะตะฝั ะบัััะพััะธ ะฝะฐ ัะตะณะพะดะฝั: *{saved_score}%*\n{saved_comment}"
        await update.message.reply_text(message, parse_mode="Markdown")
        return

    # ะัะปะธ ะฝะตั โ ะณะตะฝะตัะธััะตะผ ะฝะพะฒัะน
    score = random.randint(1, 100)
    index = min((score - 1) // 3, len(COMMENTS) - 1)
    comment = COMMENTS[index]

    # ะกะพััะฐะฝัะตะผ ะฒ ะฟะฐะผััั
    user_results[user_id] = (today_str, score, comment)

    message = f"ะขะฒะพะน ััะพะฒะตะฝั ะบัััะพััะธ: *{score}%*\n{comment}"
    await update.message.reply_text(message, parse_mode="Markdown")